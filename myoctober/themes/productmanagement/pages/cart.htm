title = "cart"
url = "/cart"
layout = "cart"
is_hidden = 0
==
<?php

	public function onStart(){


        $a = Cookie::get();
    

        $arr=[];
        $arrcart=[];
       foreach($a as $key => $value){
        $arr[$key]=$value;
       }
       $arr=array_values($arr);

       
       $arr=preg_grep('/name/i', $arr);
       foreach($arr as $value){

       	array_push($arrcart,json_decode($value));
       }

       $this['cart']=$arrcart;

   		

    }


    public function onChangeQuantity(){
    	$quantity=Input::get('quantity');
    	$id=Input::get('id');



    	$cartid = str_replace(" ","",$id);

    	if($quantity=="0"){
    		Cookie::queue($cartid,null, -1);
    	}else{
    		$cart=json_decode(Cookie::get($cartid));
	    	$cart->quantity=$quantity;
	    	$total=$cart->quantity*$cart->price;
	    	$cart->total=$total;
	    	$ob=[];
	    	foreach($cart as $key => $value){
	    		$ob[$key]=$value;
	    	}
	    	Cookie::queue($cartid,json_encode($ob), time()+86400);

	    	return [
	    		'total'=>$total,
	    	];
    	}

    	

    	
    	
    	
    }


?>



==
{% put styles %}
    <link href="{{ 'assets/css/cart.css'|theme }}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endput %}

<div class="cart-title mt-4 mb-4 d-flex justify-content-between">
	<div class="d-flex flex-row">
		<div>
			<input type="checkbox" name="check">
		</div>
		<div>
			Sản phẩm
		</div>
	</div>
	<div class="d-flex flex-row">
		<div>
			Đơn giá
		</div>
		<div class="number text-center">
			Số lượng
		</div>
		<div>
			Số tiền
		</div>
		<div>
			Thao tác
		</div>
	</div>
</div>
{% for ob in cart  %}

<div class="cart-title d-flex justify-content-between">
	<div class="d-flex flex-row">
		<div>
			<input type="checkbox" name="check">
		</div>
		<div>
			{{ob.name}}
		</div>
	</div>
	<div class="d-flex flex-row">
		<div>
			{{ob.price}} $
		</div>
		<div class="number">
			<input id="cart{{ob.id}}{{ob.color}}{{ob.size}}" class="number-spinner" type="number" value="{{ob.quantity}}" min="0" max="100" /> 
		</div>
		<div class="total">
			<span class="total_spin">{{ob.total}} $</span>
			<div class="spin spinner-border text-primary" role="status">
			  <span class="visually-hidden"></span>
			</div>
		</div>
		<div>
			Thao tác
		</div>
	</div>
</div>
{% endfor %}

{% put scripts %}
    <script src="{{ 'assets/js/bootstrap-input-spinner.js'|theme }}"></script>
    <script>
    	$('.spin').hide();
        $("input[type='number']").inputSpinner()

        $('.number-spinner').on('change',function(event){
      		event.target.parentElement.parentElement.children[2].children[0].style.display='none';
        	event.target.parentElement.parentElement.children[2].children[1].style.display='block';
        	$.request(
                'onChangeQuantity',
                {
                    data: {
                    	quantity: event.target.value,
                    	id: event.target.id
                    },
                    success: function(data) {
                    	
                    	if(data.total){
                    		event.target.parentElement.parentElement.children[2].innerHTML=`<span class="total_spin">${data.total.toFixed(2)} $</span>
								<div class="spin spinner-border text-primary" role="status">
								  <span class="visually-hidden"></span>
								</div>`;
							event.target.parentElement.parentElement.children[2].children[0].style.display='block';
							event.target.parentElement.parentElement.children[2].children[1].style.display='none';
                    	}else{
                    		event.target.parentElement.parentElement.parentElement.remove();
                    
                    	}
                    	
                    	
                      
                    }
                })
        })
    </script>
{% endput %}