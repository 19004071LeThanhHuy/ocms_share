title = "home"
url = "/"
layout = "default"
is_hidden = 0

[builderList]
modelClass = "Pm\Product\Models\Category"
scope = "-"
scopeValue = "{{ :scope }}"
displayColumn = "name"
noRecordsMessage = "No records found"
detailsPage = "-"
detailsUrlParameter = "id"
pageNumber = "{{ :page }}"
==


<?
    use Pm\Product\Models\Categorydetails;
	use Pm\Product\Models\CategoryTag;
	use Pm\Product\Models\Product;

	function onStart(){
		$this['productNew']= Product::query()->where('active',1)->take(2)->orderBy('created_at', 'desc')->get();
	}

    function onDetailscategory(){
    	$data = post();

    	$details=Categorydetails::query()->where('parent_category_id',$data['id'])->get();

    	$tag=DB::table('pm_product_category_details_tag')
    	->join('pm_product_category_tag','pm_product_category_details_tag.category_tag_id','=','pm_product_category_tag.id')
    	->join('pm_product_category_details','pm_product_category_details_tag.category_details_id','=','pm_product_category_details.id')
    	->select('pm_product_category_details.id as id','pm_product_category_tag.name as name' ,'pm_product_category_tag.slug as slug')
    	->get();

    	$product=DB::table('pm_product_')
    	->join('pm_product_category_details','pm_product_.product_category_details_id','=','pm_product_category_details.id')
    	->join('pm_product_category','pm_product_category_details.parent_category_id','pm_product_category.id')
    	->select('pm_product_category.id as id','pm_product_.name as name', 'pm_product_.id as product_id')->get();
    	
    	
        return [
        	'#Details' => $this->renderPartial('components/detailsCategory',[
        		'details'=>$details,
        		'tag'=>$tag,
        		'product'=>$product,
        		'id'=>$data['id'],
        	])
        ];

        
    }
?>


==
{% set records = builderList.records %}
{% set displayColumn = builderList.displayColumn %}
{% set noRecordsMessage = builderList.noRecordsMessage %}
{% set detailsPage = builderList.detailsPage %}
{% set detailsKeyColumn = builderList.detailsKeyColumn %}
{% set detailsUrlParameter = builderList.detailsUrlParameter %}

{% put styles %}
    <link href="{{ 'assets/css/home.css'|theme }}" rel="stylesheet">
    <link href="{{ 'assets/css/product.css'|theme }}" rel="stylesheet">
{% endput %}

<div class="view-home row w-100 h-100">
	<div class="view-home-1 col-sm-8 p-0 d-flex flex-row h-100 position-relative">
		<div class="w-25">
			<div class="view-home-1-title p-3">
				thể loại 
			</div>
			<div class="view-home-1-content d-flex">
				<div class="w-100">
					<ul class="record-list navbar-nav">
					    {% for record in records %}
					        <li id="{{record.id}}" class="category-nav nav-item pl-3 pb-1">     
								<a href="/categorys/{{ record.slug }}">
									{{ attribute(record, displayColumn) }}
								</a>
								<span class="view-home-nose text-muted pr-2">></span>        
					        </li>
					    {% else %}
					        <li class="no-data">{{ noRecordsMessage }}</li>
					    {% endfor %}
					</ul>
					<div class="end position-absolute">
						xem thêm ⇊
					</div>
				</div>

				<div id="Details" class="view-home-1-midcontent w-75 position-absolute d-flex flex-row">
		
				</div>
			</div>
		</div>
		
		
		
		<div class="w-75 p-3 view-category">
			<div class="view-home-1-title view-home-1-sub-title">
				Danh mục
			</div>
			
			<div class="row">
				<div class="grid-content-1 col d-flex flex-column mr-0">
					<div class="grid-title mt-2">
						Sản phẩm mới
						<span>New</span>
					</div>
					<div class="grid-content row h-100 p-1 px-3">
						<a class="col grid-image p-0 m-0 mr-2" href="products/{{productNew[0].slug}}">
							<img src="{{productNew[0].image.path}}" alt="">
						</a>
						<a class="col grid-image p-0 m-0" href="products/{{productNew[1].slug}}">
							<img src="{{productNew[1].image.path}}" alt="">
						</a>
					</div>
				</div>
				<div class="grid-content-2 col d-flex flex-column">
					<div class="grid-title mt-2">
						Ifashion
						<span>Hot</span>
					</div>
					<div class="grid-content row h-100 p-1 px-3">
						<div class="col grid-image p-0 m-0 mr-2">
							<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROwgMtQNg5OnZ-U5ee1d_2ZFSHJ-hxKbDTlwnkxmUx&s" alt="">
						</div>
						<div class="col grid-image p-0 m-0">
							<img src="https://cdn.pixabay.com/photo/2022/07/26/02/06/tea-plantation-7344892_960_720.jpg" alt="">
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="grid-content-3 col d-flex flex-column">
					<div class="grid-title mt-2">
						Giảm giá
						<span>sale</span>
					</div>
					<div class="grid-content row h-100 p-1 px-3">
						<div class="col grid-image p-0 m-0 mr-2 h-100">
							<img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROwgMtQNg5OnZ-U5ee1d_2ZFSHJ-hxKbDTlwnkxmUx&s" alt="">
						</div>
						<div class="col grid-image p-0 m-0 mr-2 h-100">
							<img src="https://cdn.pixabay.com/photo/2022/07/26/02/06/tea-plantation-7344892_960_720.jpg" alt="">
						</div>
						<div class="col grid-image p-0 m-0 mr-2 h-100">
							<img src="https://cdn.pixabay.com/photo/2022/07/26/02/06/tea-plantation-7344892_960_720.jpg" alt="">
						</div>
						<div class="col grid-image p-0 m-0 mr-2 h-100">
							<img src="https://cdn.pixabay.com/photo/2022/07/26/02/06/tea-plantation-7344892_960_720.jpg" alt="">
						</div>
						<div class="col grid-image p-0 m-0 mr-2 h-100">
							<img src="https://cdn.pixabay.com/photo/2022/07/26/02/06/tea-plantation-7344892_960_720.jpg" alt="">
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
	<div class="view-home-2 col ml-sm-4 p-3">
		<div class="view-home-2-image">
			<img class="image-1" src="//gw.alicdn.com/imgextra/i3/O1CN01hv61X127k1SbDU0ox_!!6000000007834-2-tps-310-200.png">
			<img class="image-2" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQidkE0cXJXok9Tm-v-y_RGXtqNRGlxxDZLOw&usqp=CAU" width="60px">
			<div class="view-home-2-text">
				Xin chào! xin chào ~
			</div>
		</div>
	</div>
</div>

<div class="view-home w-100 h-100 view-home-product">
	{% partial 'components/ListProduct' %}
</div>
<div class="text-center">
	load more
</div>
{% put scripts %}
	<script src="{{ 'assets/js/home.js'|theme }}"></script>
{% endput %}